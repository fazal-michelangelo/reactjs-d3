{"ast":null,"code":"var _jsxFileName = \"/home/fazal/Documents/reactjs/inbox-pivot/src/App.js\";\nimport React, { useEffect } from 'react';\nimport logo from \"./logo.svg\";\nimport './App.css';\nimport * as d3 from 'd3';\nimport miserableJSON from '../src/miserables.json';\nconst jsondata = miserableJSON;\n\nfunction App() {\n  useEffect(() => {\n    drawChart();\n  });\n\n  function drawChart() {\n    var width = 800;\n    var height = 600;\n    var color = d3.scaleOrdinal(d3.schemeCategory10);\n    var svg = d3.select(\"#viz\").attr(\"width\", width).attr(\"height\", height);\n    var container = svg.append(\"g\");\n    var label = {\n      'nodes': [],\n      'links': []\n    };\n    jsondata.nodes.forEach(function (d, i) {\n      label.nodes.push({\n        node: d\n      });\n      label.nodes.push({\n        node: d\n      });\n      label.links.push({\n        source: i * 2,\n        target: i * 2 + 1\n      });\n    });\n    var labelLayout = d3.forceSimulation(label.nodes).force(\"charge\", d3.forceManyBody().strength(-50)).force(\"link\", d3.forceLink(label.links).distance(0).strength(2));\n    var graphLayout = d3.forceSimulation(jsondata.nodes).force(\"charge\", d3.forceManyBody().strength(-3000)).force(\"center\", d3.forceCenter(width / 2, height / 2)).force(\"x\", d3.forceX(width / 2).strength(1)).force(\"y\", d3.forceY(height / 2).strength(1)).force(\"link\", d3.forceLink(jsondata.links).id(function (d) {\n      return d.id;\n    }).distance(50).strength(1)).on(\"tick\", ticked);\n    var adjlist = [];\n    var node = container.append(\"g\").attr(\"class\", \"nodes\").selectAll(\"g\").data(jsondata.nodes).enter().append(\"circle\").attr(\"r\", 5).attr(\"fill\", function (d) {\n      return color(d.group);\n    });\n\n    function ticked() {\n      node.call(updateNode);\n      link.call(updateLink);\n      labelLayout.alphaTarget(0.3).restart();\n      labelNode.each(function (d, i) {\n        if (i % 2 == 0) {\n          d.x = d.node.x;\n          d.y = d.node.y;\n        } else {\n          var b = this.getBBox();\n          var diffX = d.x - d.node.x;\n          var diffY = d.y - d.node.y;\n          var dist = Math.sqrt(diffX * diffX + diffY * diffY);\n          var shiftX = b.width * (diffX - dist) / (dist * 2);\n          shiftX = Math.max(-b.width, Math.min(0, shiftX));\n          var shiftY = 16;\n          this.setAttribute(\"transform\", \"translate(\" + shiftX + \",\" + shiftY + \")\");\n        }\n      });\n      labelNode.call(updateNode);\n    }\n\n    function fixna(x) {\n      if (isFinite(x)) return x;\n      return 0;\n    }\n\n    function focus(d) {\n      var index = d3.select(d3.event.target).datum().index;\n      node.style(\"opacity\", function (o) {\n        return neigh(index, o.index) ? 1 : 0.1;\n      });\n      labelNode.attr(\"display\", function (o) {\n        return neigh(index, o.node.index) ? \"block\" : \"none\";\n      });\n      link.style(\"opacity\", function (o) {\n        return o.source.index == index || o.target.index == index ? 1 : 0.1;\n      });\n    }\n\n    function unfocus() {\n      labelNode.attr(\"display\", \"block\");\n      node.style(\"opacity\", 1);\n      link.style(\"opacity\", 1);\n    }\n\n    function updateLink(link) {\n      link.attr(\"x1\", function (d) {\n        return fixna(d.source.x);\n      }).attr(\"y1\", function (d) {\n        return fixna(d.source.y);\n      }).attr(\"x2\", function (d) {\n        return fixna(d.target.x);\n      }).attr(\"y2\", function (d) {\n        return fixna(d.target.y);\n      });\n    }\n\n    function updateNode(node) {\n      node.attr(\"transform\", function (d) {\n        return \"translate(\" + fixna(d.x) + \",\" + fixna(d.y) + \")\";\n      });\n    }\n\n    svg.call(d3.zoom().scaleExtent([.1, 4]).on(\"zoom\", function () {\n      container.attr(\"transform\", d3.event.transform);\n    }));\n    var link = container.append(\"g\").attr(\"class\", \"links\").selectAll(\"line\").data(jsondata.links).enter().append(\"line\").attr(\"stroke\", \"#aaa\").attr(\"stroke-width\", \"1px\");\n    node.on(\"mouseover\", focus).on(\"mouseout\", unfocus);\n    node.call(d3.drag().on(\"start\", dragstarted).on(\"drag\", dragged).on(\"end\", dragended));\n    var labelNode = container.append(\"g\").attr(\"class\", \"labelNodes\").selectAll(\"text\").data(label.nodes).enter().append(\"text\").text(function (d, i) {\n      return i % 2 == 0 ? \"\" : d.node.id;\n    }).style(\"fill\", \"#555\").style(\"font-family\", \"Arial\").style(\"font-size\", 12).style(\"pointer-events\", \"none\"); // to prevent mouseover/drag capture\n\n    node.on(\"mouseover\", focus).on(\"mouseout\", unfocus);\n\n    function dragstarted(d) {\n      d3.event.sourceEvent.stopPropagation();\n      if (!d3.event.active) graphLayout.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(d) {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n    }\n\n    function dragended(d) {\n      if (!d3.event.active) graphLayout.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n\n    jsondata.links.forEach(function (d) {\n      adjlist[d.source.index + \"-\" + d.target.index] = true;\n      adjlist[d.target.index + \"-\" + d.source.index] = true;\n    });\n\n    function neigh(a, b) {\n      return a == b || adjlist[a + \"-\" + b];\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"svg\", {\n    id: \"viz\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 7\n    }\n  }));\n}\n\nexport default App;","map":{"version":3,"sources":["/home/fazal/Documents/reactjs/inbox-pivot/src/App.js"],"names":["React","useEffect","d3","miserableJSON","jsondata","App","drawChart","width","height","color","scaleOrdinal","schemeCategory10","svg","select","attr","container","append","label","nodes","forEach","d","i","push","node","links","source","target","labelLayout","forceSimulation","force","forceManyBody","strength","forceLink","distance","graphLayout","forceCenter","forceX","forceY","id","on","ticked","adjlist","selectAll","data","enter","group","call","updateNode","link","updateLink","alphaTarget","restart","labelNode","each","x","y","b","getBBox","diffX","diffY","dist","Math","sqrt","shiftX","max","min","shiftY","setAttribute","fixna","isFinite","focus","index","event","datum","style","o","neigh","unfocus","zoom","scaleExtent","transform","drag","dragstarted","dragged","dragended","text","sourceEvent","stopPropagation","active","fx","fy","a"],"mappings":"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","sourcesContent":["import React, {useEffect} from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nimport * as d3 from 'd3';\n\nimport miserableJSON from '../src/miserables.json';\n\nconst jsondata = miserableJSON;\n\nfunction App() {\n\n\n\nuseEffect(() => {\n  drawChart();\n});\n\nfunction drawChart() {\n    var width = 800;\n    var height = 600;\n\tvar color = d3.scaleOrdinal(d3.schemeCategory10);\n\t\n\n\tvar svg = d3.select(\"#viz\").attr(\"width\", width).attr(\"height\", height);\n\tvar container = svg.append(\"g\");\n\n      var label = {\n        'nodes': [],\n        'links': []\n      };\n      jsondata.nodes.forEach(function (d, i) {\n      label.nodes.push({ node: d });\n      label.nodes.push({ node: d });\n      label.links.push({\n        source: i * 2,\n        target: i * 2 + 1\n      });\n\t});\n\t\n\n\tvar labelLayout = d3.forceSimulation(label.nodes)\n\t.force(\"charge\", d3.forceManyBody().strength(-50))\n\t.force(\"link\", d3.forceLink(label.links).distance(0).strength(2));\n\n\n\n    var graphLayout = d3.forceSimulation(jsondata.nodes)\n      .force(\"charge\", d3.forceManyBody().strength(-3000))\n      .force(\"center\", d3.forceCenter(width / 2, height / 2))\n      .force(\"x\", d3.forceX(width / 2).strength(1))\n      .force(\"y\", d3.forceY(height / 2).strength(1))\n      .force(\"link\", d3.forceLink(jsondata.links).id(function (d) { return d.id; }).distance(50).strength(1))\n      .on(\"tick\", ticked);\n\n\tvar adjlist = [];\n\t\n\n\n    var node = container.append(\"g\").attr(\"class\", \"nodes\")\n      .selectAll(\"g\")\n      .data(jsondata.nodes)\n      .enter()\n      .append(\"circle\")\n      .attr(\"r\", 5)\n\t  .attr(\"fill\", function (d) { return color(d.group); })\n\t  \n\tfunction ticked() {\n\n\t\tnode.call(updateNode);\n\t\tlink.call(updateLink);\n  \n\t\tlabelLayout.alphaTarget(0.3).restart();\n\t\tlabelNode.each(function (d, i) {\n\t\t  if (i % 2 == 0) {\n\t\t\td.x = d.node.x;\n\t\t\td.y = d.node.y;\n\t\t  } else {\n\t\t\tvar b = this.getBBox();\n  \n\t\t\tvar diffX = d.x - d.node.x;\n\t\t\tvar diffY = d.y - d.node.y;\n  \n\t\t\tvar dist = Math.sqrt(diffX * diffX + diffY * diffY);\n  \n\t\t\tvar shiftX = b.width * (diffX - dist) / (dist * 2);\n\t\t\tshiftX = Math.max(-b.width, Math.min(0, shiftX));\n\t\t\tvar shiftY = 16;\n\t\t\tthis.setAttribute(\"transform\", \"translate(\" + shiftX + \",\" + shiftY + \")\");\n\t\t  }\n\t\t});\n\t\tlabelNode.call(updateNode);\n  \n\t}\n\t\n\t\n\n    function fixna(x) {\n\t\tif (isFinite(x)) return x;\n\t\treturn 0;\n\t  }\n  \n\t  function focus(d) {\n\t\tvar index = d3.select(d3.event.target).datum().index;\n\t\tnode.style(\"opacity\", function (o) {\n\t\t  return neigh(index, o.index) ? 1 : 0.1;\n\t\t});\n\t\tlabelNode.attr(\"display\", function (o) {\n\t\t  return neigh(index, o.node.index) ? \"block\" : \"none\";\n\t\t});\n\t\tlink.style(\"opacity\", function (o) {\n\t\t  return o.source.index == index || o.target.index == index ? 1 : 0.1;\n\t\t});\n\t  }\n  \n\t  function unfocus() {\n\t\tlabelNode.attr(\"display\", \"block\");\n\t\tnode.style(\"opacity\", 1);\n\t\tlink.style(\"opacity\", 1);\n\t  }\n  \n\t  function updateLink(link) {\n\t\tlink.attr(\"x1\", function (d) { return fixna(d.source.x); })\n\t\t  .attr(\"y1\", function (d) { return fixna(d.source.y); })\n\t\t  .attr(\"x2\", function (d) { return fixna(d.target.x); })\n\t\t  .attr(\"y2\", function (d) { return fixna(d.target.y); });\n\t  }\n  \n\t  function updateNode(node) {\n\t\tnode.attr(\"transform\", function (d) {\n\t\t  return \"translate(\" + fixna(d.x) + \",\" + fixna(d.y) + \")\";\n\t\t});\n\t  }\n\n\n\n\n\n\t  svg.call(\n\t\td3.zoom()\n\t\t  .scaleExtent([.1, 4])\n\t\t  .on(\"zoom\", function () { container.attr(\"transform\", d3.event.transform); })\n\t  );\n  \n\t  var link = container.append(\"g\").attr(\"class\", \"links\")\n\t\t.selectAll(\"line\")\n\t\t.data(jsondata.links)\n\t\t.enter()\n\t\t.append(\"line\")\n\t\t.attr(\"stroke\", \"#aaa\")\n\t\t.attr(\"stroke-width\", \"1px\");\n  \n  \n\t  node.on(\"mouseover\", focus).on(\"mouseout\", unfocus);\n  \n\t  node.call(\n\t\td3.drag()\n\t\t  .on(\"start\", dragstarted)\n\t\t  .on(\"drag\", dragged)\n\t\t  .on(\"end\", dragended)\n\t  );\n  \n\t  var labelNode = container.append(\"g\").attr(\"class\", \"labelNodes\")\n\t\t.selectAll(\"text\")\n\t\t.data(label.nodes)\n\t\t.enter()\n\t\t.append(\"text\")\n\t\t.text(function (d, i) { return i % 2 == 0 ? \"\" : d.node.id; })\n\t\t.style(\"fill\", \"#555\")\n\t\t.style(\"font-family\", \"Arial\")\n\t\t.style(\"font-size\", 12)\n\t\t.style(\"pointer-events\", \"none\"); // to prevent mouseover/drag capture\n  \n\t  node.on(\"mouseover\", focus).on(\"mouseout\", unfocus);\n  \n  \n  \n  \n\t  function dragstarted(d) {\n\t\td3.event.sourceEvent.stopPropagation();\n\t\tif (!d3.event.active) graphLayout.alphaTarget(0.3).restart();\n\t\td.fx = d.x;\n\t\td.fy = d.y;\n\t  }\n  \n\t  function dragged(d) {\n\t\td.fx = d3.event.x;\n\t\td.fy = d3.event.y;\n\t  }\n  \n\t  function dragended(d) {\n\t\tif (!d3.event.active) graphLayout.alphaTarget(0);\n\t\td.fx = null;\n\t\td.fy = null;\n\t  }\n\n\n\n\t  jsondata.links.forEach(function (d) {\n\t\tadjlist[d.source.index + \"-\" + d.target.index] = true;\n\t\tadjlist[d.target.index + \"-\" + d.source.index] = true;\n\t  });\n  \n\t  function neigh(a, b) {\n\t\treturn a == b || adjlist[a + \"-\" + b];\n\t  }\n\t  \n\n}\n\n  return (\n    <div className=\"App\">\n      <svg id='viz'></svg>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}