{"ast":null,"code":"var _jsxFileName = \"/home/fazal/Documents/reactjs/inbox-pivot/src/App.js\";\nimport React, { useEffect } from 'react';\nimport logo from \"./logo.svg\";\nimport './App.css';\nimport * as d3 from 'd3';\nimport miserableJSON from '../src/miserables.json';\n\nfunction App() {\n  useEffect(() => {\n    drawChart();\n  });\n\n  function drawChart() {\n    const jsondata = {\n      \"nodes\": [],\n      \"links\": []\n    };\n    const pivotData = {\n      \"AtkScore\": [\"385\", \"135\", \"110\"],\n      \"ChainPhase\": [\"Lateral Movement\", \"Data Theft\", \"Privilege Escalation\"],\n      \"ThreatIds\": [\"credtheft_kerberoasting\\n\", \"filetheft_active_monitoring\\n\"]\n    };\n\n    function initNodeStructure() {\n      var index = 0;\n      jsondata.nodes.push({\n        'id': 'realm',\n        'group': index\n      });\n      jsondata.nodes.push({\n        'id': 'USER',\n        'group': index\n      });\n      jsondata.links.push({\n        'source': 'USER',\n        'target': 'realm',\n        'value': 0\n      });\n\n      for (var key in pivotData) {\n        if (pivotData.hasOwnProperty(key)) {\n          jsondata.links.push({\n            'source': key,\n            'target': 'realm',\n            'value': 0\n          });\n          index++;\n          jsondata.nodes.push({\n            'id': key,\n            'group': index\n          });\n\n          for (var i = 0; i < pivotData[key].length; i++) {\n            jsondata.nodes.push({\n              'id': pivotData[key][i],\n              'group': index\n            });\n            jsondata.links.push({\n              'source': pivotData[key][i],\n              'target': key,\n              'value': index\n            });\n          }\n        }\n      }\n\n      console.log(jsondata);\n    }\n\n    initNodeStructure();\n    var width = 800;\n    var height = 600;\n    var color = d3.scaleOrdinal(d3.schemeCategory10);\n    var label = {\n      'nodes': [],\n      'links': []\n    };\n    jsondata.nodes.forEach(function (d, i) {\n      label.nodes.push({\n        node: d\n      });\n      label.nodes.push({\n        node: d\n      });\n      label.links.push({\n        source: i * 2,\n        target: i * 2 + 1\n      });\n    });\n    var labelLayout = d3.forceSimulation(label.nodes).force(\"charge\", d3.forceManyBody().strength(-50)).force(\"link\", d3.forceLink(label.links).distance(0).strength(2));\n    var graphLayout = d3.forceSimulation(jsondata.nodes).force(\"charge\", d3.forceManyBody().strength(-3000)).force(\"center\", d3.forceCenter(width / 2, height / 2)).force(\"x\", d3.forceX(width / 2).strength(1)).force(\"y\", d3.forceY(height / 2).strength(1)).force(\"link\", d3.forceLink(jsondata.links).id(function (d) {\n      return d.id;\n    }).distance(50).strength(1)).on(\"tick\", ticked);\n    var adjlist = [];\n    jsondata.links.forEach(function (d) {\n      adjlist[d.source.index + \"-\" + d.target.index] = true;\n      adjlist[d.target.index + \"-\" + d.source.index] = true;\n    });\n\n    function neigh(a, b) {\n      return a == b || adjlist[a + \"-\" + b];\n    }\n\n    var svg = d3.select(\"#viz\").attr(\"width\", width).attr(\"height\", height);\n    var container = svg.append(\"g\");\n    svg.call(d3.zoom().scaleExtent([.1, 4]).on(\"zoom\", function () {\n      container.attr(\"transform\", d3.event.transform);\n    }));\n    var link = container.append(\"g\").attr(\"class\", \"links\").selectAll(\"line\").data(jsondata.links).enter().append(\"line\").attr(\"stroke\", \"#aaa\").attr(\"stroke-width\", \"1px\");\n    var node = container.append(\"g\").attr(\"class\", \"nodes\").selectAll(\"g\").data(jsondata.nodes).enter().append(\"circle\").attr(\"r\", 5).attr(\"fill\", function (d) {\n      return color(d.group);\n    }); // .append('text')\n    // .attr('font-family', 'Arial')\n    // .attr('font-size', '14px')\n    // .text(function (d) { return d.fontIcon });\n\n    node.on(\"mouseover\", focus).on(\"mouseout\", unfocus);\n    node.call(d3.drag().on(\"start\", dragstarted).on(\"drag\", dragged).on(\"end\", dragended));\n    var labelNode = container.append(\"g\").attr(\"class\", \"labelNodes\").selectAll(\"text\").data(label.nodes).enter().append(\"text\").text(function (d, i) {\n      return i % 2 == 0 ? \"\" : d.node.id;\n    }).style(\"fill\", \"#555\").style(\"font-family\", \"Arial\").style(\"font-size\", 12).style(\"pointer-events\", \"none\"); // to prevent mouseover/drag capture\n\n    node.on(\"mouseover\", focus).on(\"mouseout\", unfocus);\n\n    function ticked() {\n      node.call(updateNode);\n      link.call(updateLink);\n      labelLayout.alphaTarget(0.3).restart();\n      labelNode.each(function (d, i) {\n        if (i % 2 == 0) {\n          d.x = d.node.x;\n          d.y = d.node.y;\n        } else {\n          var b = this.getBBox();\n          var diffX = d.x - d.node.x;\n          var diffY = d.y - d.node.y;\n          var dist = Math.sqrt(diffX * diffX + diffY * diffY);\n          var shiftX = b.width * (diffX - dist) / (dist * 2);\n          shiftX = Math.max(-b.width, Math.min(0, shiftX));\n          var shiftY = 16;\n          this.setAttribute(\"transform\", \"translate(\" + shiftX + \",\" + shiftY + \")\");\n        }\n      });\n      labelNode.call(updateNode);\n    }\n\n    function fixna(x) {\n      if (isFinite(x)) return x;\n      return 0;\n    }\n\n    function focus(d) {\n      var index = d3.select(d3.event.target).datum().index;\n      node.style(\"opacity\", function (o) {\n        return neigh(index, o.index) ? 1 : 0.1;\n      });\n      labelNode.attr(\"display\", function (o) {\n        return neigh(index, o.node.index) ? \"block\" : \"none\";\n      });\n      link.style(\"opacity\", function (o) {\n        return o.source.index == index || o.target.index == index ? 1 : 0.1;\n      });\n    }\n\n    function unfocus() {\n      labelNode.attr(\"display\", \"block\");\n      node.style(\"opacity\", 1);\n      link.style(\"opacity\", 1);\n    }\n\n    function updateLink(link) {\n      link.attr(\"x1\", function (d) {\n        return fixna(d.source.x);\n      }).attr(\"y1\", function (d) {\n        return fixna(d.source.y);\n      }).attr(\"x2\", function (d) {\n        return fixna(d.target.x);\n      }).attr(\"y2\", function (d) {\n        return fixna(d.target.y);\n      });\n    }\n\n    function updateNode(node) {\n      node.attr(\"transform\", function (d) {\n        return \"translate(\" + fixna(d.x) + \",\" + fixna(d.y) + \")\";\n      });\n    }\n\n    function dragstarted(d) {\n      d3.event.sourceEvent.stopPropagation();\n      if (!d3.event.active) graphLayout.alphaTarget(0.3).restart();\n      d.fx = d.x;\n      d.fy = d.y;\n    }\n\n    function dragged(d) {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n    }\n\n    function dragended(d) {\n      if (!d3.event.active) graphLayout.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"App\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"svg\", {\n    id: \"viz\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 13\n    }\n  }));\n}\n\nexport default App;","map":{"version":3,"sources":["/home/fazal/Documents/reactjs/inbox-pivot/src/App.js"],"names":["React","useEffect","d3","miserableJSON","App","drawChart","jsondata","pivotData","initNodeStructure","index","nodes","push","links","key","hasOwnProperty","i","length","console","log","width","height","color","scaleOrdinal","schemeCategory10","label","forEach","d","node","source","target","labelLayout","forceSimulation","force","forceManyBody","strength","forceLink","distance","graphLayout","forceCenter","forceX","forceY","id","on","ticked","adjlist","neigh","a","b","svg","select","attr","container","append","call","zoom","scaleExtent","event","transform","link","selectAll","data","enter","group","focus","unfocus","drag","dragstarted","dragged","dragended","labelNode","text","style","updateNode","updateLink","alphaTarget","restart","each","x","y","getBBox","diffX","diffY","dist","Math","sqrt","shiftX","max","min","shiftY","setAttribute","fixna","isFinite","datum","o","sourceEvent","stopPropagation","active","fx","fy"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\n\nimport * as d3 from 'd3';\n\nimport miserableJSON from '../src/miserables.json';\n\n\n\nfunction App() {\n\n\n\n\n    useEffect(() => {\n        drawChart();\n    });\n\n    function drawChart() {\n\n\n        const jsondata = {\n            \"nodes\": [\n            ],\n            \"links\": [\n                \n            ]\n          }\n          ;\n    \n        const pivotData = {\n            \"AtkScore\": [\n                \"385\",\n                \"135\",\n                \"110\"\n            ],\n            \"ChainPhase\": [\n                \"Lateral Movement\",\n                \"Data Theft\",\n                \"Privilege Escalation\"\n            ],\n            \"ThreatIds\": [\n                \"credtheft_kerberoasting\\n\",\n                \"filetheft_active_monitoring\\n\"\n            ]\n        }\n        \n        function initNodeStructure() {\n            var index = 0;\n            jsondata.nodes.push({'id': 'realm', 'group': index});\n            jsondata.nodes.push({'id': 'USER', 'group': index});\n            jsondata.links.push({'source': 'USER', 'target': 'realm', 'value': 0})\n    \n            for (var key in pivotData) {  \n                if (pivotData.hasOwnProperty(key)) {\n                    jsondata.links.push({'source': key, 'target': 'realm', 'value': 0})\n                    index++;            \n                    jsondata.nodes.push({'id': key, 'group': index})\n                    for(var i = 0 ; i < pivotData[key].length; i++) {\n                        jsondata.nodes.push({'id': pivotData[key][i], 'group': index});\n                        jsondata.links.push({'source': pivotData[key][i], 'target': key, 'value': index})\n                    }\n                }\n            }\n            console.log(jsondata);\n        }\n\n        initNodeStructure()\n\n\n        var width = 800;\n        var height = 600;\n        var color = d3.scaleOrdinal(d3.schemeCategory10);\n\n        var label = {\n            'nodes': [],\n            'links': []\n        };\n\n        jsondata.nodes.forEach(function (d, i) {\n            label.nodes.push({ node: d });\n            label.nodes.push({ node: d });\n            label.links.push({\n                source: i * 2,\n                target: i * 2 + 1\n            });\n        });\n\n        var labelLayout = d3.forceSimulation(label.nodes)\n            .force(\"charge\", d3.forceManyBody().strength(-50))\n            .force(\"link\", d3.forceLink(label.links).distance(0).strength(2));\n\n        var graphLayout = d3.forceSimulation(jsondata.nodes)\n            .force(\"charge\", d3.forceManyBody().strength(-3000))\n            .force(\"center\", d3.forceCenter(width / 2, height / 2))\n            .force(\"x\", d3.forceX(width / 2).strength(1))\n            .force(\"y\", d3.forceY(height / 2).strength(1))\n            .force(\"link\", d3.forceLink(jsondata.links).id(function (d) { return d.id; }).distance(50).strength(1))\n            .on(\"tick\", ticked);\n\n        var adjlist = [];\n\n        jsondata.links.forEach(function (d) {\n            adjlist[d.source.index + \"-\" + d.target.index] = true;\n            adjlist[d.target.index + \"-\" + d.source.index] = true;\n        });\n\n        function neigh(a, b) {\n            return a == b || adjlist[a + \"-\" + b];\n        }\n\n        var svg = d3.select(\"#viz\").attr(\"width\", width).attr(\"height\", height);\n        var container = svg.append(\"g\");\n\n        svg.call(\n            d3.zoom()\n                .scaleExtent([.1, 4])\n                .on(\"zoom\", function () { container.attr(\"transform\", d3.event.transform); })\n        );\n\n        var link = container.append(\"g\").attr(\"class\", \"links\")\n            .selectAll(\"line\")\n            .data(jsondata.links)\n            .enter()\n            .append(\"line\")\n            .attr(\"stroke\", \"#aaa\")\n            .attr(\"stroke-width\", \"1px\");\n\n        var node = container.append(\"g\").attr(\"class\", \"nodes\")\n            .selectAll(\"g\")\n            .data(jsondata.nodes)\n            .enter()\n            .append(\"circle\")\n            .attr(\"r\", 5)\n            .attr(\"fill\", function (d) { return color(d.group); })\t\t\t\n            // .append('text')\n            // .attr('font-family', 'Arial')\n            // .attr('font-size', '14px')\n            // .text(function (d) { return d.fontIcon });\n\n\n        node.on(\"mouseover\", focus).on(\"mouseout\", unfocus);\n\n        node.call(\n            d3.drag()\n                .on(\"start\", dragstarted)\n                .on(\"drag\", dragged)\n                .on(\"end\", dragended)\n        );\n\n        var labelNode = container.append(\"g\").attr(\"class\", \"labelNodes\")\n            .selectAll(\"text\")\n            .data(label.nodes)\n            .enter()\n            .append(\"text\")\n            .text(function (d, i) { return i % 2 == 0 ? \"\" : d.node.id; })\n            .style(\"fill\", \"#555\")\n            .style(\"font-family\", \"Arial\")\n            .style(\"font-size\", 12)\n            .style(\"pointer-events\", \"none\"); // to prevent mouseover/drag capture\n\n        node.on(\"mouseover\", focus).on(\"mouseout\", unfocus);\n\n        function ticked() {\n\n            node.call(updateNode);\n            link.call(updateLink);\n\n            labelLayout.alphaTarget(0.3).restart();\n            labelNode.each(function (d, i) {\n                if (i % 2 == 0) {\n                    d.x = d.node.x;\n                    d.y = d.node.y;\n                } else {\n                    var b = this.getBBox();\n\n                    var diffX = d.x - d.node.x;\n                    var diffY = d.y - d.node.y;\n\n                    var dist = Math.sqrt(diffX * diffX + diffY * diffY);\n\n                    var shiftX = b.width * (diffX - dist) / (dist * 2);\n                    shiftX = Math.max(-b.width, Math.min(0, shiftX));\n                    var shiftY = 16;\n                    this.setAttribute(\"transform\", \"translate(\" + shiftX + \",\" + shiftY + \")\");\n                }\n            });\n            labelNode.call(updateNode);\n\n        }\n\n        function fixna(x) {\n            if (isFinite(x)) return x;\n            return 0;\n        }\n\n        function focus(d) {\n            var index = d3.select(d3.event.target).datum().index;\n            node.style(\"opacity\", function (o) {\n                return neigh(index, o.index) ? 1 : 0.1;\n            });\n            labelNode.attr(\"display\", function (o) {\n                return neigh(index, o.node.index) ? \"block\" : \"none\";\n            });\n            link.style(\"opacity\", function (o) {\n                return o.source.index == index || o.target.index == index ? 1 : 0.1;\n            });\n        }\n\n        function unfocus() {\n            labelNode.attr(\"display\", \"block\");\n            node.style(\"opacity\", 1);\n            link.style(\"opacity\", 1);\n        }\n\n        function updateLink(link) {\n            link.attr(\"x1\", function (d) { return fixna(d.source.x); })\n                .attr(\"y1\", function (d) { return fixna(d.source.y); })\n                .attr(\"x2\", function (d) { return fixna(d.target.x); })\n                .attr(\"y2\", function (d) { return fixna(d.target.y); });\n        }\n\n        function updateNode(node) {\n            node.attr(\"transform\", function (d) {\n                return \"translate(\" + fixna(d.x) + \",\" + fixna(d.y) + \")\";\n            });\n        }\n\n        function dragstarted(d) {\n            d3.event.sourceEvent.stopPropagation();\n            if (!d3.event.active) graphLayout.alphaTarget(0.3).restart();\n            d.fx = d.x;\n            d.fy = d.y;\n        }\n\n        function dragged(d) {\n            d.fx = d3.event.x;\n            d.fy = d3.event.y;\n        }\n\n        function dragended(d) {\n            if (!d3.event.active) graphLayout.alphaTarget(0);\n            d.fx = null;\n            d.fy = null;\n        }\n    }\n\n    return (\n        <div className=\"App\">\n            <svg id='viz'></svg>\n        </div>\n    );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}