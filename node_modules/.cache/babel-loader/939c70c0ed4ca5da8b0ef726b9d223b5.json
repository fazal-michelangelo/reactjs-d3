{"ast":null,"code":"var _jsxFileName = \"/home/fazal/Documents/claudius/D3-charts/src/BollingerBands.js\";\nimport React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\nimport { lab } from 'd3';\n\nconst moment = require('moment');\n\nconst BollingerBands = props => {\n  useEffect(() => {\n    drawChart();\n  });\n\n  function drawChart() {\n    var height = 600;\n    var width = 900;\n    var margin = {\n      top: 10,\n      right: 20,\n      bottom: 30,\n      left: 40\n    };\n    const svg = d3.select('body').append('svg').attr(\"width\", width).attr(\"height\", height).style(\"overflow\", \"visible\");\n    var data = Object.assign(d3.csvParse(\"aapl.csv\".text(), d3.autoType).map(({\n      date,\n      close\n    }) => ({\n      date,\n      value: close\n    })), {\n      y: \"$ Close\"\n    });\n    var x = d3.scaleTime().domain(d3.extent(data, d => d.date)).rangeRound([margin.left, width - margin.right]);\n    var y = d3.scaleLog().domain(d3.extent(values)).rangeRound([height - margin.bottom - 20, margin.top]);\n\n    var xAxis = g => g.attr(\"transform\", `translate(0,${height - margin.bottom})`).call(d3.axisBottom(x).ticks(width / 80)).call(g => g.select(\".domain\").remove());\n\n    var yAxis = g => g.attr(\"transform\", `translate(${margin.left},0)`).call(d3.axisLeft(y).tickValues(d3.ticks(...y.domain(), 10)).tickFormat(d => d)).call(g => g.select(\".domain\").remove()).call(g => g.selectAll(\".tick line\").clone().attr(\"x2\", width - margin.left - margin.right).attr(\"stroke-opacity\", 0.1)).call(g => g.select(\".tick:last-of-type text\").clone().attr(\"x\", 3).attr(\"text-anchor\", \"start\").attr(\"font-weight\", \"bold\").text(data.y));\n\n    var line = d3.line().defined(d => !isNaN(d)).x((d, i) => x(data[i].date)).y(y);\n    svg.append(\"g\").call(xAxis);\n    svg.append(\"g\").call(yAxis);\n    svg.append(\"g\").attr(\"fill\", \"none\").attr(\"stroke-width\", 1.5).attr(\"stroke-linejoin\", \"round\").attr(\"stroke-linecap\", \"round\").selectAll(\"path\").data([values, ...bollinger(values, N, [-K, 0, +K])]).join(\"path\").attr(\"stroke\", (d, i) => [\"#aaa\", \"green\", \"blue\", \"red\"][i]).attr(\"d\", line);\n\n    function bollinger(values, N, K) {\n      let i = 0;\n      let sum = 0;\n      let sum2 = 0;\n      const bands = K.map(() => new Float64Array(values.length).fill(NaN));\n\n      for (let n = Math.min(N - 1, values.length); i < n; ++i) {\n        const value = values[i];\n        sum += value, sum2 += value ** 2;\n      }\n\n      for (let n = values.length, m = bands.length; i < n; ++i) {\n        const value = values[i];\n        sum += value, sum2 += value ** 2;\n        const mean = sum / N;\n        const deviation = Math.sqrt((sum2 - sum ** 2 / N) / (N - 1));\n\n        for (let j = 0; j < K.length; ++j) {\n          bands[j][i] = mean + deviation * K[j];\n        }\n\n        const value0 = values[i - N + 1];\n        sum -= value0, sum2 -= value0 ** 2;\n      }\n\n      return bands;\n    }\n  }\n\n  const d3Container = useRef(null);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d3-lollipop-chart\",\n    width: 996,\n    height: 444,\n    ref: d3Container,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }\n  });\n};\n\nexport default BollingerBands;","map":{"version":3,"sources":["/home/fazal/Documents/claudius/D3-charts/src/BollingerBands.js"],"names":["React","useRef","useEffect","d3","lab","moment","require","BollingerBands","props","drawChart","height","width","margin","top","right","bottom","left","svg","select","append","attr","style","data","Object","assign","csvParse","text","autoType","map","date","close","value","y","x","scaleTime","domain","extent","d","rangeRound","scaleLog","values","xAxis","g","call","axisBottom","ticks","remove","yAxis","axisLeft","tickValues","tickFormat","selectAll","clone","line","defined","isNaN","i","bollinger","N","K","join","sum","sum2","bands","Float64Array","length","fill","NaN","n","Math","min","m","mean","deviation","sqrt","j","value0","d3Container"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\nimport { lab } from 'd3';\nconst moment = require('moment');\n\n\nconst BollingerBands = (props) => {\n    useEffect(() => {\n        drawChart();\n    });\n\n    function drawChart() {\n\n        var height = 600;\n        var width = 900;\n        var margin = ({top: 10, right: 20, bottom: 30, left: 40})\n\n            const svg = d3.select('body').append('svg')\n                .attr(\"width\", width)\n                .attr(\"height\", height)\n                .style(\"overflow\", \"visible\");\n\n                var data = Object.assign(d3.csvParse((\"aapl.csv\").text(), d3.autoType).map(({date, close}) => ({date, value: close})), {y: \"$ Close\"})\n\n\n                var x = d3.scaleTime()\n    .domain(d3.extent(data, d => d.date))\n    .rangeRound([margin.left, width - margin.right])\n\n          var y = d3.scaleLog()\n          .domain(d3.extent(values))\n          .rangeRound([height - margin.bottom - 20, margin.top]);\n\n\n          var xAxis = g => g\n          .attr(\"transform\", `translate(0,${height - margin.bottom})`)\n          .call(d3.axisBottom(x).ticks(width / 80))\n          .call(g => g.select(\".domain\").remove());\n\n\n          var yAxis = g => g\n          .attr(\"transform\", `translate(${margin.left},0)`)\n          .call(d3.axisLeft(y).tickValues(d3.ticks(...y.domain(), 10)).tickFormat(d => d))\n          .call(g => g.select(\".domain\").remove())\n          .call(g => g.selectAll(\".tick line\").clone()\n              .attr(\"x2\", width - margin.left - margin.right)\n              .attr(\"stroke-opacity\", 0.1))\n          .call(g => g.select(\".tick:last-of-type text\").clone()\n              .attr(\"x\", 3)\n              .attr(\"text-anchor\", \"start\")\n              .attr(\"font-weight\", \"bold\")\n              .text(data.y));\n\n\n\n              var line = d3.line()\n    .defined(d => !isNaN(d))\n    .x((d, i) => x(data[i].date))\n    .y(y)\n\n    \n            svg.append(\"g\")\n                .call(xAxis);\n          \n            svg.append(\"g\")\n                .call(yAxis);\n          \n            svg.append(\"g\")\n                .attr(\"fill\", \"none\")\n                .attr(\"stroke-width\", 1.5)\n                .attr(\"stroke-linejoin\", \"round\")\n                .attr(\"stroke-linecap\", \"round\")\n              .selectAll(\"path\")\n              .data([values, ...bollinger(values, N, [-K, 0, +K])])\n              .join(\"path\")\n                .attr(\"stroke\", (d, i) => [\"#aaa\", \"green\", \"blue\", \"red\"][i])\n                .attr(\"d\", line);\n        \n                \n                function bollinger(values, N, K) {\n                    let i = 0;\n                    let sum = 0;\n                    let sum2 = 0;\n                    const bands = K.map(() => new Float64Array(values.length).fill(NaN));\n                    for (let n = Math.min(N - 1, values.length); i < n; ++i) {\n                      const value = values[i];\n                      sum += value, sum2 += value ** 2;\n                    }\n                    for (let n = values.length, m = bands.length; i < n; ++i) {\n                      const value = values[i];\n                      sum += value, sum2 += value ** 2;\n                      const mean = sum / N;\n                      const deviation = Math.sqrt((sum2 - sum ** 2 / N) / (N - 1));\n                      for (let j = 0; j < K.length; ++j) {\n                        bands[j][i] = mean + deviation * K[j];\n                      }\n                      const value0 = values[i - N + 1];\n                      sum -= value0, sum2 -= value0 ** 2;\n                    }\n                    return bands;\n                  }\n\n\n    }\n\n    const d3Container = useRef(null);\n\n    return (\n        <div\n            className=\"d3-lollipop-chart\"\n            width={996}\n            height={444}\n            ref={d3Container}\n        ></div>\n    );\n}\n\nexport default BollingerBands;"]},"metadata":{},"sourceType":"module"}